<!DOCTYPE html>
<html lang=en>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width">
        <title>u1-ico Test</title>

        <script src="https://cdn.jsdelivr.net/gh/nuxodin/lazyfill/mod.js"></script>
        <script src="https://cdn.jsdelivr.net/gh/nuxodin/lazyfill/htmlfills.js"></script>

        <script src="../auto.js" type=module></script>

        <style>
        html {
            --u1-ico-dir:'https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/icons/';
        }
        </style>

<body style="display:flex; flex-wrap:wrap;">

    <aside style="flex:1 1 auto; background:var(--color-light)">
        <nav style="position:sticky; top:0; bottom:0; height:100vh; padding:2rem; overflow:auto">
            <ul id=nav></ul>
        </nav>
    </aside>

    <main style="flex:199 1 auto">

        <section id=reposSec>
            <script type=module>
                const repos = await fetch('../repos.json').then(res=>res.json());
                const extToName = {
                    'el':'Elements',
                    'attr':'Attributes',
                    'js':'JavaScript',
                    'class':'Classes',
                    'css':'Stylesheets',
                };
                const typedRepos = {};
                for (const repo of repos) {
                    const ext = repo.name.match(/\.([^]+)$/)?.[1];
                    typedRepos[ext]??=[];
                    typedRepos[ext].push(repo);
                }
                // sort inside each group
                for (const [key, repos] of Object.entries(typedRepos)) {
                    typedRepos[key] = repos.sort((r1, r2)=>{
                        if(r1.name < r2.name) return -1;
                        if(r1.name > r2.name) return 1;
                        return 0;
                    });
                }

                let str = '';
                let navStr = '';
                for (const [ext, entries] of Object.entries(typedRepos)) {
                    if (ext == 'undefined') continue;
                    navStr += `<h2>${extToName[ext]}</h2>`;
                    for (let repo of entries) {
                        let url = `https://github.com/u1ui/${repo.name}`;
                        let release = repo.release_latest;

                        let repoDate    = new Date(repo.pushed_at);
                        let releaseDate = new Date(release.published_at);

                        const masterNotPushed = repoDate > releaseDate
                        const localUrl = '../../' + repo.name;


                        // const tag = 'u1-'+repo.name.replace(/\.el$/,'');
                        // str +=
                        // `
                        // <figure>
                        //     <${tag}>copy</${tag}>
                        // </figure>
                        // <u1-code trim editable oninput="this.previousElementSibling.innerHTML = this.value">
                        //     <script type=x>
                        //         <${tag}>copy</${tag}>
                        //     <\/script>
                        // </u1-code>
                        // `;

                        str +=
                        `
                        <div style="border-bottom:2px solid; padding:3rem" id="repo_${repo.name}">
                            <h2 style="margin-bottom:0">
                                ${repo.name}
                                <a href="${url}" target=github><u1-ico inline>github</u1-ico></a>
                            </h2>
                            <div style="margin-bottom:2rem">${repo.description??''}</div>

                            <label>
                                <input type=checkbox onclick="let iframe = this.parentNode.nextElementSibling; iframe[(this.checked?'set':'remove')+'Attribute']('sandbox',''); iframe.src=iframe.src+'?'">
                                disable javascript
                            </label>
                            <!--label>
                                <input type=checkbox onclick="let style = this.parentNode.nextElementSibling.contentWindow.document.documentElement.style; style.colorScheme = style.colorScheme==='dark'?'light':'dark'">
                                toggle theme
                            </label-->
                            <iframe loading=lazy src="${localUrl}/tests/test.html" style="height:39rem"></iframe>
                        </div>
                        `
                        navStr += `
                        <li>
                            <a href="#repo_${repo.name}">${repo.name}</a>
                        `
                    }
                }
                document.getElementById('repos').innerHTML = str;
                document.getElementById('nav').innerHTML = navStr;
            </script>
            <div id=repos></div>
        </section>
    </main>